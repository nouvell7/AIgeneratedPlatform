# 🚀 Production Deployment Guide

## 📋 Prerequisites

1. **Install CLI tools**:
   ```bash
   npm install -g vercel @railway/cli
   ```

2. **Create accounts**:
   - [Vercel](https://vercel.com) (Frontend)
   - [Railway](https://railway.app) (Backend + Database)

## 🏗️ Architecture Overview

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Vercel        │    │   Railway       │    │   Railway       │
│   (Frontend)    │───▶│   (Backend)     │───▶│   (PostgreSQL)  │
│   Next.js PWA   │    │   Node.js API   │    │   + Redis       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🚂 Step 1: Railway Backend Setup

### 1.1 Create Railway Project
```bash
railway login
railway init
railway add postgresql
railway add redis
```

### 1.2 Set Environment Variables
```bash
# Database (auto-generated by Railway)
railway variables set DATABASE_URL=${{Postgres.DATABASE_URL}}
railway variables set REDIS_URL=${{Redis.REDIS_URL}}

# JWT Secrets (generate strong secrets)
railway variables set JWT_SECRET=$(openssl rand -base64 32)
railway variables set JWT_REFRESH_SECRET=$(openssl rand -base64 32)

# OAuth (get from respective providers)
railway variables set GOOGLE_CLIENT_ID=your_google_client_id
railway variables set GOOGLE_CLIENT_SECRET=your_google_client_secret
railway variables set GITHUB_CLIENT_ID=your_github_client_id
railway variables set GITHUB_CLIENT_SECRET=your_github_client_secret
railway variables set GITHUB_TOKEN=your_github_token

# External APIs
railway variables set TEACHABLE_MACHINE_API_KEY=your_tm_api_key
railway variables set HUGGING_FACE_API_KEY=your_hf_api_key
railway variables set CLOUDFLARE_API_TOKEN=your_cf_token
railway variables set GOOGLE_ADSENSE_CLIENT_ID=your_adsense_client_id
railway variables set GOOGLE_ADSENSE_CLIENT_SECRET=your_adsense_secret

# Environment
railway variables set NODE_ENV=production
railway variables set PORT=3001
```

### 1.3 Deploy Backend
```bash
railway up --service backend
```

## ⚡ Step 2: Vercel Frontend Setup

### 2.1 Connect to Vercel
```bash
cd packages/frontend
vercel login
vercel link
```

### 2.2 Set Environment Variables
```bash
# Get your Railway backend URL first
BACKEND_URL=$(railway status --json | jq -r '.deployments[0].url')

# Set Vercel environment variables
vercel env add NEXT_PUBLIC_API_URL production
# Enter: $BACKEND_URL

vercel env add NEXT_PUBLIC_FRONTEND_URL production
# Enter: https://your-app.vercel.app

vercel env add NEXT_PUBLIC_GOOGLE_CLIENT_ID production
# Enter: your_google_client_id

vercel env add NEXT_PUBLIC_GITHUB_CLIENT_ID production
# Enter: your_github_client_id
```

### 2.3 Deploy Frontend
```bash
vercel --prod
```

## 🔧 Step 3: Domain Setup (Optional)

### 3.1 Custom Domain for Frontend
```bash
vercel domains add your-domain.com
```

### 3.2 Custom Domain for Backend
1. Go to Railway dashboard
2. Settings → Networking
3. Add custom domain: `api.your-domain.com`

## 📊 Step 4: Monitoring Setup

### 4.1 Railway Monitoring
- Built-in metrics dashboard
- Automatic health checks
- Log aggregation

### 4.2 Vercel Analytics
```bash
vercel analytics enable
```

## 🔄 Step 5: CI/CD Setup

### 5.1 GitHub Actions for Railway
Add to `.github/workflows/deploy-railway.yml`:

```yaml
name: Deploy to Railway

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run build:backend
      - uses: railway-app/railway-action@v1
        with:
          railway-token: ${{ secrets.RAILWAY_TOKEN }}
          command: up --service backend
```

### 5.2 Vercel Auto-Deploy
- Automatic on git push to main
- Preview deployments for PRs
- No additional setup needed

## 💰 Cost Estimation

### Free Tier Limits
- **Vercel**: 100GB bandwidth, unlimited deployments
- **Railway**: $5 credit/month (~500 hours)

### Paid Tier Costs
- **Vercel Pro**: $20/month (team features, more bandwidth)
- **Railway**: $5-20/month (based on usage)

**Total Monthly Cost**: $0-40 depending on traffic

## 🚨 Production Checklist

- [ ] Environment variables set
- [ ] Database migrations run
- [ ] SSL certificates active
- [ ] Health checks passing
- [ ] Monitoring configured
- [ ] Backup strategy in place
- [ ] Domain DNS configured
- [ ] OAuth apps configured
- [ ] External API keys valid

## 🔧 Troubleshooting

### Common Issues

1. **Build Failures**
   ```bash
   # Check build logs
   railway logs --service backend
   vercel logs
   ```

2. **Database Connection Issues**
   ```bash
   # Test database connection
   railway run --service backend npm run db:test
   ```

3. **Environment Variable Issues**
   ```bash
   # List all variables
   railway variables
   vercel env ls
   ```

## 📞 Support

- **Railway**: [docs.railway.app](https://docs.railway.app)
- **Vercel**: [vercel.com/docs](https://vercel.com/docs)
- **Project Issues**: Create GitHub issue

## 🎯 Quick Deploy Command

```bash
# One-command deployment
./scripts/deploy-production.sh
```